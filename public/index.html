<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="style.css">
<title>Gaming Store</title>
</head>

<body>

<nav>

<div class="logo">ğŸ”¥ Gaming Store</div>

<input 
class="search"
placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..."
onkeyup="searchProducts(this.value)"
>

</nav>


<div class="container" id="products"></div>


<div class="cartBtn" onclick="toggleCart()">
ğŸ›’
</div>

<div class="cart" id="cart">

<h2>Ø§Ù„Ø³Ù„Ø©</h2>

<div id="cartItems"></div>

<h3 id="total"></h3>

<div class="checkout">

<input id="name" placeholder="Ø§Ù„Ø§Ø³Ù…">
<input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
<input id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
<input id="apartment" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø´Ù‚Ø©">
<input id="floor" placeholder="Ø§Ù„Ø¯ÙˆØ±">

<button onclick="checkout()">
Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
</button>

</div>

</div>


<script>

let allProducts=[];
let cart=[];


// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª

fetch("/api/products")
.then(r=>r.json())
.then(data=>{
allProducts=data;
render(data);
});

function render(products){

productsDiv.innerHTML="";

products.forEach(p=>{

productsDiv.innerHTML+=`

<div class="card">

<img src="${p.images[0]}">

<h3>${p.name}</h3>

${p.discount ? 
`<small style="text-decoration:line-through">
${p.price}
</small>` : ""}

<div class="price">
${p.discount ? p.price - p.discount : p.price} Ø¬Ù†ÙŠÙ‡
</div>

<button onclick='addToCart(${JSON.stringify(p)})'>
Ø§Ø¶Ù Ù„Ù„Ø³Ù„Ø©
</button>

</div>

`;

});

}


const productsDiv=document.getElementById("products");


// Ø§Ù„Ø¨Ø­Ø«

function searchProducts(val){

const filtered = allProducts.filter(p=>
p.name.toLowerCase().includes(val.toLowerCase())
);

render(filtered);
}



// Ø§Ù„Ø³Ù„Ø©

function toggleCart(){
cart.classList.toggle("showCart");
}

function addToCart(product){

const existing = cart.find(p=>p.id===product.id);

if(existing){
existing.qty++;
}else{
product.qty=1;
cart.push(product);
}

updateCart();

}

function updateCart(){

cartItems.innerHTML="";

let total=0;

cart.forEach(p=>{

total += (p.discount ? p.price-p.discount : p.price)*p.qty;

cartItems.innerHTML+=`

<p>
${p.name} x ${p.qty}
</p>

`;

});

document.getElementById("total").innerText=
"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: "+total+" Ø¬Ù†ÙŠÙ‡";

}



// checkout

function checkout(){

if(!name.value || !phone.value || !address.value){
alert("Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");
return;
}

fetch("/api/orders",{
method:"POST",
headers:{
"Content-Type":"application/json"
},
body:JSON.stringify({
customer:{
name:name.value,
phone:phone.value,
address:address.value,
apartment:apartment.value,
floor:floor.value
},
cart
})
});

alert("ØªÙ… Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ğŸ”¥");

cart=[];
updateCart();

}

</script>

</body>
</html>
